%h2
  %a{:href=>'#', :class=>'dotoggle', :data=>{'block'=>'#new_content'}}= "+ CrÃ©er un article"

#new_content.hide
  = form_tag "/pages" do

    = hidden_field_tag 'article[category]', params[:id]

    %p.well
      = t('content_visibility')
      %select{:name=>'article[location_id]'}
        %option{:value=>0}= t('all_locations')
        - @locations.each do |location|
          %option{:value=>location.id}= location.name

    %label= t('title')
    = text_field_tag 'article[title]'

    %label= t('calendar')
    = text_field_tag 'article[calendar]'

    %label= t('video')
    = text_field_tag 'article[video]'

    %label= t('content')
    = text_area_tag 'article[content]', {}, :class=>'expandable MCEeditable'
    %br
    = submit_tag t('save'), :class=>'btn  btn-warning'

#contents
  - @articles.each do |article|

    .hr{:style=>'border-bottom:5px solid #d4d4d4;margin-bottom:30px;'}

    = form_tag "/pages/#{article.id}", :method=>:put do

      = hidden_field_tag 'article[category]', params[:id]

      %p.well
        = t('content_visibility')
        %select{:name=>'article[location_id]'}
          %option{:value=>0}= t('all_locations')
          - @locations.each do |location|
            %option{:value=>location.id}= location.name

      %label= t('title')
      = text_field_tag 'article[title]', article.title

      %label= t('calendar')
      = text_field_tag 'article[calendar]', show_calendar(article.calendar)

      %label= t('video')
      = text_field_tag 'article[video]', show_video(article.video)

      %label= t('content')
      .content_container.hide
        = soft_clean article.content
      .textarea_container
      %br
      %a{:href=>"/pages/#{article.id}", :class=>'left', :data=>{'method'=>'delete', 'confirm'=>t('confirms.delete_article')}}
        %i.icon-remove
        = "Supprimer cet article"

      = submit_tag t('save'), :class=>'btn btn-warning right'


= javascript_include_tag "/javascripts/tinymce/jscripts/tiny_mce/tiny_mce.js"

:javascript

  $('.content_container').each(function(){
    $(this).next('.textarea_container').append("<textarea name='article[content]' class='expandable MCEeditable'>"+$(this).html()+"</textarea>")
  });

  tinyMCE.init({
    // General options
    mode : "textareas",
    editor_selector : "MCEeditable",
    theme : "advanced",
    skin : "o2k7",
    skin_variant : "black",
    plugins : "safari,xhtmlxtras,media,paste,table",
    language : "fr",
    height: '340px',
    width: '880px',
    content_css : "/assets/bootstrap.css",

    // Theme options
    theme_advanced_buttons1 : "bold,italic,underline,strikethrough,bullist,numlist,blockquote,justifyleft,justifycenter,justifyright,formatselect,link,unlink,pasteword,|,tablecontrols",
    theme_advanced_toolbar_location : "top",
    theme_advanced_toolbar_align: "left",
    theme_advanced_resizing: true,
    entity_encoding: "named",
    relative_urls: false,
    convert_urls: true
  });

